

<!DOCTYPE html>
<html lang="en">
<head>
<title>Rake::Builder - Joe Yates' Blog</title>
<meta content="Presenting the Rake Builder gem" name="description">
<meta content="width=device-width" name="viewport">
<link href="/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml">
<link href="/assets/app-cb475e5b8a234b2a45f4bc6cceeb180c.css" media="all" rel="stylesheet">
<script defer="true" src="/assets/application-04330b44b64bd6872cdc831811bd0720.js" type="text/javascript"></script>
</head>
<body class="font-sans text-xl bg-olive flex justify-center">
<div class="max-w-full min-h-screen md:w-[40rem] bg-light-olive py-4 px-10 flex flex-col">
<header>
<nav>
<ul class="flex list-none">
<li class="mr-8">
<a href="/">Home</a></li>
<li class="mr-8">
<a href="/posts/">Archives</a></li>
<li>
<a href="/categories/">Categories</a></li></ul></nav>
<div class="prose">
<h1>
Rake::Builder</h1></div></header>

<main class="max-w-full grow mx-1">

<section class="space-y-4 prose">
<div class="flex justify-end mb-4">
<div>2010/08/29</div>
</div>
<h2 class="text-lg">
Presenting the Rake Builder gem
</h2>
<p>Use Rake::Builder as a Make Replacement:</p><pre title="language: shell"><code class="language-shell">$ rake build</code></pre><p></p><p>I've put together a rake-based system for building C and C++ projects.</p><p>I've called it Rake::Builder, it's available on GitHub <a href="http://github.com/joeyates/rake-builder" target="_blank">here</a>.</p><h2>autoconf</h2><p>Build systems are complicated by external dependencies: finding third-party headers and libraries. Often there is a specific configuration for each operating system and distribution.</p><p>The standard system is GNU's autoconf system, but it is a nightmare. At the most simple level, you distribute source code with a Makefile.</p><p>The problem is that Makefiles are just pure dependency managers - if they don't find what they need, they just fail.</p><p>The solution to that problem is the use of <string>configure</strong>. Configure runs a series of compatibility tests, sniffs the host system and spits out a Makefile.</p><p>So, with configure, the user then does the following:</p><pre title="language: shell"><code class="language-shell">$ ./configure
$ make
$ sudo make install</code></pre><p></p><p>But, configure itself is a long file, and it's a program: about 6000 lines of shell code.</p><p>A few lines:</p><pre title="language: shell"><code class="language-shell">ac_ext=cpp
ac_cpp='$CXXCPP $CPPFLAGS'
ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'</code></pre><p></p><p>The solution to having to maintain configure? Generate it!</p><p>With autotools, there is a seemingly eternal regress of configuration files and scripts generated by other scripts.</p><p>This was my project's root directory listing before I gave up on autoconf:</p><pre title="language: shell"><code class="language-shell">AUTHORS
COPYING
ChangeLog
EXAMPLE
INSTALL
Makefile
Makefile.am
Makefile.in
NEWS
README
aclocal.m4
autom4te.cache
config.h
config.h.in
config.log
config.status
configure
configure.ac
depcomp
include
install-sh
missing
objects
src
stamp-h1
test</code></pre><p>Fifteen of those files are involved in the mechanics of autoconf.</p><div class="flex flex-col items-center not-prose"><img src="https://blog-cms.joeyates.info/api/media/file/autoconf.png" alt="autoconf dependencies" width="977" height="749"><div class="mt-1 text-sm text-gray-500 text-center">autoconf dependencies</div></div><p>Autoconf doesn't really address the issue of building on various systems and adapting semi-automatically. You still have to add all the settings, but you have to learn where in a myriad of files these settings are to be placed.</p><h2>Rake</h2><p>Of the autoconf alternatives, rake seems to offer the cleanest solution. Rake itself was apparently created as a build system for C, but out of the box it's too generic: it's simply a dependency handling system.</p><p>There are already a number of specializations of rake. In Rails projects, and Gem building, Rakefiles handle maintenance, testing, documentation building and packaging.</p><p>Rake::Builder is my attempt to specialise rake to the task of building C and C++ projects.</p><p>I've got to version 0.0.11 and it now builds the following types of projects:</p><ul><li>C++,</li><li>QT C++,</li><li>C,</li><li>Objective-C.</li></ul><p>This is an example with two build targets: a static library and a test executable, with the test project depending on the library:</p><pre title="language: ruby"><code class="language-ruby">require 'rake/builder'

Rake::Builder.new do |builder|
  builder.target               = 'libactive_record_sqlite.a'
  builder.source_search_paths  = [ 'src' ]
  builder.header_search_paths  = [ 'include/**/*.h' ]
  builder.objects_path         = 'objects'
  builder.include_paths        = [ 'include' ]
  builder.library_dependencies = [ 'sqlite3' ]
end

Rake::Builder.new do |builder|
  builder.task_namespace       = :test
  builder.target               = 'active_record_test'
  builder.source_search_paths  = [ 'test' ]
  builder.header_search_paths  = [ 'test' ]
  builder.objects_path         = 'test/lib_objects'
  builder.include_paths        = [ 'include', 'test' ]
  builder.library_dependencies = [ 'sqlite3', 'gtest', 'gtest_main', 'active_record_sqlite' ]
  builder.library_paths        = [ 'objects' ]
  builder.target_prerequisites = [ :'rake:build' ]
  builder.default_task         = [ :run ]
end</code></pre><p>I'm about to start using Rake::Builder on a sizeable C++ project using QT, so I'll have a chance to see if it handles real world stuff without turning into autoconf.</p>
</section>
<ul class="paginate">
<li>

<a href="/posts/hello-gosu/">← Newer</a></li>
<li>

<a href="/posts/use-g-as-an-alias-for-git-without-losing-autocompletion/">Older →</a></li></ul>
</main>
<footer class="bottom-0 mt-6">
<hr class="mb-4">

<div class="flex flex-row justify-between text-sm">
<div>
<span>Made with</span>
<a href="https://github.com/joeyates/fermo">Fermo</a>
</div>
<p>&copy; Joe Yates 2010</p>
</div></footer>
</div></body></html>
